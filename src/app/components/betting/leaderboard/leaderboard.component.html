<div class="container mt-4">
  <!-- Betting Game Navigation -->
  <nav class="navbar navbar-expand navbar-light bg-light rounded mb-4">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h5">ðŸŽ® Betting Game</span>
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" routerLink="/betting/shop" routerLinkActive="fw-bold text-primary">Card Shop</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/betting/cards" routerLinkActive="fw-bold text-primary">My Cards</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/betting/tables" routerLinkActive="fw-bold text-primary">Betting Tables</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/betting/wallet" routerLinkActive="fw-bold text-primary">My Wallet</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" routerLink="/betting/leaderboard" routerLinkActive="fw-bold text-primary">Leaderboard</a>
        </li>
      </ul>
    </div>
  </nav>

  <h2>Leaderboard</h2>
  <p class="text-muted">Top players in the betting game</p>

  <!-- Error Alert -->
  <div class="alert alert-danger" role="alert" *ngIf="error">
    {{ error }}
  </div>

  <!-- User Rank Card -->
  <div class="card mb-4" *ngIf="userRank">
    <div class="card-body">
      <h5 class="card-title">Your Ranking</h5>
      <div class="row">
        <div class="col-md-2">
          <div class="text-center">
            <h1 class="text-primary">{{ userRank.rank }}</h1>
            <p class="text-muted">of {{ userRank.totalPlayers }}</p>
          </div>
        </div>
        <div class="col-md-10">
          <div class="row">
            <div class="col-md-3">
              <strong>Net Profit:</strong> {{ userRank.stats.netProfit }} chips
            </div>
            <div class="col-md-3">
              <strong>Win Rate:</strong> {{ formatWinRate(userRank.stats.winRate) }}
            </div>
            <div class="col-md-3">
              <strong>Total Wins:</strong> {{ userRank.stats.totalWins }}
            </div>
            <div class="col-md-3">
              <strong>Current Streak:</strong> {{ userRank.stats.currentStreak }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sort Options -->
  <div class="row mb-3">
    <div class="col-md-3">
      <select class="form-select" [(ngModel)]="sortBy" (change)="onSortChange()">
        <option value="netProfit">Sort by Net Profit</option>
        <option value="winRate">Sort by Win Rate</option>
        <option value="totalWins">Sort by Total Wins</option>
      </select>
    </div>
  </div>

  <!-- Loading -->
  <div class="text-center my-5" *ngIf="loading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading leaderboard...</p>
  </div>

  <!-- Leaderboard Table -->
  <div class="table-responsive" *ngIf="!loading">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Player</th>
          <th class="text-end">Net Profit</th>
          <th class="text-end">Win Rate</th>
          <th class="text-end">Total Bets</th>
          <th class="text-end">Wins</th>
          <th class="text-end">Losses</th>
          <th class="text-end">Current Streak</th>
          <th class="text-end">Longest Streak</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let entry of leaderboard; let i = index"
            [class.table-primary]="isCurrentUser(entry.email)">
          <td>
            <span class="badge" [ngClass]="getRankBadgeClass(i + 1)">
              {{ i + 1 }}
            </span>
          </td>
          <td>
            {{ entry.email }}
            <span class="badge bg-success ms-2" *ngIf="isCurrentUser(entry.email)">You</span>
          </td>
          <td class="text-end" [class.text-success]="entry.netProfit > 0" [class.text-danger]="entry.netProfit < 0">
            {{ entry.netProfit }}
          </td>
          <td class="text-end">{{ formatWinRate(entry.winRate) }}</td>
          <td class="text-end">{{ entry.totalBets }}</td>
          <td class="text-end text-success">{{ entry.totalWins }}</td>
          <td class="text-end text-danger">{{ entry.totalLosses }}</td>
          <td class="text-end">{{ entry.currentStreak }}</td>
          <td class="text-end">{{ entry.longestWinStreak }}</td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div class="text-center my-5" *ngIf="leaderboard.length === 0">
      <p class="text-muted">No players on the leaderboard yet.</p>
    </div>
  </div>
</div>
